<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Ruby on Rails - oxd Docs</title>
  

  <link rel="shortcut icon" href="../../../img/gluu_favicon.ico">
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../../css/highlight.css">

  <script src="../../../js/jquery-2.1.1.min.js"></script>
  <script src="../../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../../js/highlight.pack.js"></script>
  <script src="../../../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../../.." class="icon icon-home"> oxd Docs</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
			
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../..">Home</a>
        
    </li>
<li>
		
          
			
            <li>
    <ul class="subnav">
    <li><span>oxd Server</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../protocol/">Protocol</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../install/">Installation</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../conf/">Configuration</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../logs/">Logs</a>
        
    </li>

        
    </ul>
<li>
		
          
			
            <li>
    <ul class="subnav">
    <li><span>Libraries</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../libraries/api-client-libraries/">oxd API Client Libraries</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../libraries/python/">Python</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../libraries/java/">Java</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../libraries/php/">PHP</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../libraries/node/">Node</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../libraries/ruby/">Ruby</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../libraries/csharp/">CSharp</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../libraries/perl/">Perl</a>
        
    </li>

        
    </ul>
<li>
		
          
			
            <li>
    <ul class="subnav">
    <li><span>Plugin</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../plugin/wordpress/">Wordpress</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../plugin/magento/">Magento</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../plugin/drupal/">Drupal</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../plugin/opencart/">OpenCart</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../plugin/sugarcrm/">SugarCRM</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../plugin/suitecrm/">SuiteCRM</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../plugin/roundcube/">RoundCube</a>
        
    </li>

        
    </ul>
<li>
		
          
			
            <li>
    <ul class="subnav">
    <li><span>Framework</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../spring/">Java Spring</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../play/">Java Play Framework</a>
        
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">Ruby on Rails</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#oxd-ruby-on-rails-demo-site">oxd Ruby On Rails Demo site</a></li>
                
                    <li><a class="toctree-l4" href="#deployment">Deployment</a></li>
                
                    <li><a class="toctree-l4" href="#demosite-deployment">Demosite deployment</a></li>
                
                    <li><a class="toctree-l4" href="#enjoy">Enjoy!</a></li>
                
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../python/">Python Flask</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../node/">Node/Express</a>
        
    </li>

        
    </ul>
<li>
		
          
		
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../..">oxd Docs</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../..">Docs</a> &raquo;</li>
    
      
        
          <li>Framework &raquo;</li>	 
        
      
    
    <li>Ruby on Rails</li>
    <li class="wy-breadcrumbs-aside">
           
      
        
          <a href="https://github.com/GluuFederation/docs-oxd//blob/master/sources/2.4.4/framework/ruby/index.md" class="icon icon-github"> Edit on GitHub</a>
      
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="oxd-ruby-on-rails-demo-site">oxd Ruby On Rails Demo site</h1>
<p>The following documentation shows how to configure Ruby on Rails apps to use oxd for authentication. </p>
<h2 id="deployment">Deployment</h2>
<h3 id="prerequisites">Prerequisites</h3>
<p>Ubuntu 14.04 with some basic utilities listed below</p>
<pre><code class="bash">$ sudo apt-get install apache2
$ a2enmod ssl
</code></pre>

<h3 id="installing-and-configuring-the-oxd-server">Installing and configuring the oxd-server</h3>
<p>You can download the oxd-server and follow the installation instructions from <a href="https://www.gluu.org/docs-oxd">here</a></p>
<h2 id="demosite-deployment">Demosite deployment</h2>
<p>OpenID Connect works only with HTTPS connections. So let us get the ssl certs ready.</p>
<pre><code class="bash">$ mkdir /etc/certs
$ cd /etc/certs
$ openssl genrsa -des3 -out demosite.key 2048
$ openssl rsa -in demosite.key -out demosite.key.insecure
$ mv demosite.key.insecure demosite.key
$ openssl req -new -key demosite.key -out demosite.csr
$ openssl x509 -req -days 365 -in demosite.csr -signkey demosite.key -out demosite.crt
</code></pre>

<h3 id="install-rvm-and-ruby-on-ubuntu">Install RVM and Ruby on ubuntu</h3>
<p>Install mpapis public key first (might need gpg2) </p>
<pre><code class="bash">$ sudo gpg --keyserver hkp://keys.gnupg.net --recv-keys 409B6B1796C275462A1703113804BB82D39DC0E3
</code></pre>

<p>Install RVM stable with ruby:</p>
<pre><code class="bash">$ sudo \curl -sSL https://get.rvm.io | bash -s stable --ruby
$ cd /var/www/html
</code></pre>

<p>Reload shell configuration &amp; test</p>
<pre><code class="bash">$ source ~/.rvm/scripts/rvm
</code></pre>

<p>Run this command in terminal to get list of installed ruby versions on your system</p>
<pre><code class="bash">$ rvm list
</code></pre>

<p>Using rvm you can install specific ruby version. E.g. for ruby-2.2.0 :</p>
<pre><code class="bash">$ rvm install ruby-2.2.0
</code></pre>

<p>To change ruby version simply run this command. E.g. to switch to ruby-2.2.0 :</p>
<pre><code class="bash">$ rvm use ruby-2.2.0
</code></pre>

<p>Rails is distributed as a Ruby gem and adding it to the local system is extremely simple:</p>
<pre><code class="bash">$ gem install rails 
</code></pre>

<p>For more help you can see rvm commands here :
https://rvm.io/rvm/install</p>
<h3 id="phusion-passenger-setup">Phusion Passenger Setup</h3>
<p>Phusion Passenger (commonly shortened to Passenger or referred to as mod_passenger) is an application server and it is often used to power Ruby sites. Its code is distributed in form of a Ruby gem, which is then compiled on the target machine and installed into Apache as a module.</p>
<p>First, the gem needs to be installed on the system:</p>
<pre><code class="bash">$ gem install passenger
</code></pre>

<p>The environment is now ready for the compilation. The process takes a few minutes and it’s started by the following command:</p>
<pre><code class="bash">$ passenger-install-apache2-module
</code></pre>

<p>Note that this script will not install the module really. It will compile module’s binary and place it under gem’s path. The path will be printed on screen and it needs to be copy-pasted into Apache’s config file </p>
<p>The output will be similar to this one:</p>
<pre><code>LoadModule passenger_module /home/username/.rvm/gems/ruby-2.2.1/gems/passenger-5.0.28/buildout/apache2/mod_passenger.so
</code></pre>

<p>Then in Apache's config file add these lines :</p>
<pre><code>&lt;IfModule mod_passenger.c&gt;
 PassengerRoot /home/username/.rvm/gems/ruby-2.2.1/gems/passenger-5.0.28
 PassengerDefaultRuby /home/username/.rvm/gems/ruby-2.2.1/wrappers/ruby
&lt;/IfModule&gt;
</code></pre>

<p>In console :</p>
<pre><code class="bash">$ sudo cp /etc/apache2/sites-available/000-default.conf /etc/apache2/sites-available/oxd-ruby.conf
$ sudo vi /etc/apache2/sites-available/oxd-ruby.conf
</code></pre>

<p>Replace the content of oxd-ruby.conf file with following:</p>
<pre><code>&lt;IfModule mod_ssl.c&gt;
    &lt;VirtualHost *:443&gt;
        ServerAdmin webmaster@localhost
        ServerName oxd-rails.com
        DocumentRoot /var/www/html/oxdrails

        LogLevel info ssl:warn
        ErrorLog ${APACHE_LOG_DIR}/error.log
        CustomLog ${APACHE_LOG_DIR}/access.log combined

        #   SSL Engine Switch:
        #   Enable/Disable SSL for this virtual host.
        SSLEngine on
        SSLCertificateFile  /etc/certs/demosite.crt
        SSLCertificateKeyFile /etc/certs/demosite.key

        &lt;Directory /var/www/html/oxdrails&gt;
            AllowOverride All
                    Options Indexes FollowSymLinks
            Order allow,deny
            Allow from all
        &lt;/Directory&gt;
    &lt;/VirtualHost&gt;
&lt;/IfModule&gt;
</code></pre>

<p>Then enable <code>oxd-rails.com</code> virtual host by running:</p>
<pre><code class="bash">$ sudo a2ensite oxd-ruby.conf 
</code></pre>

<p>After that add domain name in virtual host file.
In console:</p>
<pre><code class="bash">$ sudo nano /etc/hosts
</code></pre>

<p>Add these lines in virtual host file:</p>
<pre><code>127.0.0.1 www.oxd-rails.com
127.0.0.1 oxd-rails.com
</code></pre>

<p>Reload the apache server</p>
<pre><code class="bash">$ sudo service apache2 restart
</code></pre>

<h3 id="setting-up-and-running-demo-app">Setting up and running demo app</h3>
<p>Navigate to Rails app root:</p>
<pre><code class="bash">cd /var/www/html/oxdrails
</code></pre>

<p>Run :</p>
<pre><code class="bash">bundle install
</code></pre>

<p>Now your rails app should work from http://oxd-rails.com</p>
<h2 id="enjoy">Enjoy!</h2>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../python/" class="btn btn-neutral float-right" title="Python Flask"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../play/" class="btn btn-neutral" title="Java Play Framework"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
    <!-- Copyright etc -->
    </p>
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../play/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../python/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
